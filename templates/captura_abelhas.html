{% extends "base.html" %}

{% block content %}
<div class="container">
    <div class="honeycomb-bg"></div>
    <h2><i class="fas fa-bug"></i> Captura de Abelhas</h2>

    <form method="POST" action="{{ url_for('registrar_captura') }}">
        <div class="form-group">
            <label for="observacaoCaptura"><i class="fas fa-clipboard-list"></i> Motivo/Observação</label>
            <input type="text" id="observacaoCaptura" name="observacaoCaptura" placeholder="Motivo da captura ou observações..." required>
        </div>

        <div class="btn-group">
            <button type="submit" class="btn">
                <i class="fas fa-save"></i> Registrar Captura
            </button>
            <a href="{{ url_for('monitoramento') }}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Voltar
            </a>
        </div>
    </form>

    <h3><i class="fas fa-history"></i> Minhas Capturas</h3>
    <div id="capturas">
        {% for captura in capturas %}
        <div class="captura">
            <strong><i class="fas fa-calendar"></i> Data/Hora:</strong> {{ captura.data_captura.strftime('%d/%m/%Y %H:%M') }}<br>
            <strong><i class="fas fa-user"></i> Registrado por:</strong> {{ captura.usuario.nome }}<br>
            <strong><i class="fas fa-clipboard-list"></i> Observação:</strong> {{ captura.observacao }}<br>
            
            {% if is_admin or captura.usuario_id == session.usuario_id %}
            <form method="POST" action="{{ url_for('excluir_captura', id=captura.id) }}" style="display: inline;">
                <button type="submit" onclick="return confirm('Tem certeza que deseja apagar esta captura?')">
                    <i class="fas fa-trash"></i> Apagar
                </button>
            </form>
            {% endif %}
        </div>
        {% else %}
        <p>Nenhuma captura registrada ainda.</p>
        {% endfor %}
    </div>

    <h3><i class="fas fa-users"></i> Todas as Capturas da Equipe</h3>
    <div id="todas-capturas">
        {% for captura in todas_capturas %}
        <div class="captura">
            <strong><i class="fas fa-calendar"></i> Data/Hora:</strong> {{ captura.data_captura.strftime('%d/%m/%Y %H:%M') }}<br>
            <strong><i class="fas fa-user"></i> Registrado por:</strong> {{ captura.usuario.nome }}<br>
            <strong><i class="fas fa-clipboard-list"></i> Observação:</strong> {{ captura.observacao }}<br>
        </div>
        {% else %}
        <p>Nenhuma captura registrada pela equipe.</p>
        {% endfor %}
    </div>
</div>
{% endblock %}